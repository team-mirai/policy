name: PR Comment for Notification Info

on:
  pull_request:
    types: [opened, synchronize]
    paths:
      - '[0-9]*.md'

jobs:
  comment-notification-info:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      issues: write
    # åˆå›ã®PRã‚ªãƒ¼ãƒ—ãƒ³æ™‚ã€ã¾ãŸã¯æ”¿ç­–ãƒ•ã‚¡ã‚¤ãƒ«ãŒåˆã‚ã¦è¿½åŠ ã•ã‚ŒãŸæ™‚ã®ã¿ã‚³ãƒ¡ãƒ³ãƒˆ
    steps:
      - name: Check if comment already exists
        id: check-comment
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const comments = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
            });
            
            const botComment = comments.data.find(comment => 
              comment.user.type === 'Bot' && 
              comment.body.includes('Xï¼ˆæ—§Twitterï¼‰é€šçŸ¥ã«ã¤ã„ã¦')
            );
            
            return !botComment;

      - name: Post notification info comment
        if: steps.check-comment.outputs.result == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const body = `## ğŸ“¢ Xï¼ˆæ—§Twitterï¼‰é€šçŸ¥ã«ã¤ã„ã¦

            ã“ã®PRãŒãƒãƒ¼ã‚¸ã•ã‚Œã‚‹ã¨ã€è‡ªå‹•çš„ã«Xï¼ˆæ—§Twitterï¼‰ã«æŠ•ç¨¿ã•ã‚Œã¾ã™ã€‚

            ã‚‚ã—ä»¥ä¸‹ã®ã‚ˆã†ãªæ”¿ç­–å†…å®¹ã®å®Ÿè³ªçš„ãªå¤‰æ›´ã‚’å«ã¾ãªã„PRã®å ´åˆã€Xé€šçŸ¥ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
            - ã‚¿ã‚¤ãƒã‚„èª¤å­—è„±å­—ã®ä¿®æ­£
            - ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆèª¿æ•´
            - ãƒªãƒ³ã‚¯åˆ‡ã‚Œã®ä¿®æ­£
            - ãã®ä»–ã€æ”¿ç­–å†…å®¹ã«å®Ÿè³ªçš„ãªå¤‰æ›´ã‚’å«ã¾ãªã„ä¿®æ­£

            ### é€šçŸ¥ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹æ–¹æ³•
            PRã« \`skip-notification\` ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
            1. å³å´ã®Labelsã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
            2. \`skip-notification\` ã‚’é¸æŠ

            â€» Slacké€šçŸ¥ã¯å†…éƒ¨é€²æ—ç®¡ç†ã®ãŸã‚ã€å¼•ãç¶šãé€ä¿¡ã•ã‚Œã¾ã™ã€‚`;
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: body
            });